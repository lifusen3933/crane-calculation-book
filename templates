#!/usr/bin/env python3
"""
æ¼”ç¤ºè„šæœ¬ - å¿«é€Ÿç”Ÿæˆèµ·é‡æœºè®¾è®¡è®¡ç®—ä¹¦
"""
import sys
import os
sys.path.append(os.path.dirname(os.path.abspath(__file__)))

from models.crane_specs import CraneSpecs
from crane_calculator.calculation_engine import CalculationEngine


def run_demo():
    """è¿è¡Œæ¼”ç¤º"""
    print("\n" + "=" * 80)
    print("  ğŸ—ï¸  èµ·é‡æœºè®¾è®¡è®¡ç®—ä¹¦è‡ªåŠ¨ç”Ÿæˆç³»ç»Ÿ - æ¼”ç¤º")
    print("=" * 80)

    # åˆ›å»ºä¸€ä¸ªç¤ºä¾‹èµ·é‡æœº
    specs = CraneSpecs(
        crane_type="æ¡¥å¼",
        rated_capacity=10.0,
        span=20.0,
        lifting_height=9.0,
        work_level="A3",
        lifting_speed=8.0,
        trolley_speed=20.0,
        crane_speed=30.0,
        trolley_weight=1.5,
        crane_self_weight=12.0,
        gantry_weight=None,
        wind_speed=25.0,
        ambient_temp_min=-20,
        ambient_temp_max=40,
        power_supply="380V/50Hz",
        control_type="é©¾é©¶å®¤"
    )

    print("\nğŸ“‹ èµ·é‡æœºå‚æ•°:")
    print(f"   ç±»å‹: {specs.crane_type}")
    print(f"   é¢å®šèµ·é‡é‡: {specs.rated_capacity} å¨")
    print(f"   è·¨åº¦: {specs.span} ç±³")
    print(f"   èµ·å‡é«˜åº¦: {specs.lifting_height} ç±³")
    print(f"   å·¥ä½œçº§åˆ«: {specs.work_level}")

    # æ‰§è¡Œè®¡ç®—
    print("\nğŸš€ æ­£åœ¨æ‰§è¡Œè®¡ç®—...")
    engine = CalculationEngine()
    summary = engine.run_calculation(specs)

    # ç”Ÿæˆè®¡ç®—ä¹¦
    print("\nğŸ“„ æ­£åœ¨ç”Ÿæˆè®¡ç®—ä¹¦...")
    report = engine.generate_full_report(summary, specs)

    # ä¿å­˜æ–‡ä»¶
    filename = f"demo_calculation_{specs.crane_type}_{specs.rated_capacity}t_{specs.span}m.md"
    with open(filename, 'w', encoding='utf-8') as f:
        f.write(report)

    print(f"\nâœ… æ¼”ç¤ºå®Œæˆ!")
    print(f"   è®¡ç®—ä¹¦å·²ä¿å­˜åˆ°: {filename}")
    print(f"   æ–‡ä»¶å¤§å°: {len(report)} å­—ç¬¦")

    # æ˜¾ç¤ºä¸»è¦ç»“æœ
    print("\nğŸ“Š ä¸»è¦è®¡ç®—ç»“æœ:")
    print(f"   ä¸»æ¢å¼¯æ›²åº”åŠ›: {summary.main_beam.bending_stress:.1f} MPa (è®¸ç”¨: 235 MPa)")
    print(f"   ä¸»æ¢å‰ªåº”åŠ›: {summary.main_beam.shear_stress:.1f} MPa (è®¸ç”¨: 136 MPa)")
    print(f"   ä¸»æ¢æœ€å¤§æŒ åº¦: {summary.main_beam.max_deflection:.1f} mm")
    print(f"   ç¨³å®šç³»æ•°: {summary.stability.stability_factor:.2f} (è¦æ±‚: â‰¥ 1.4)")
    print(f"   èµ·å‡ç”µæœº: {summary.hoisting_motor.motor_type}")
    print(f"   å°è½¦è¿è¡Œç”µæœº: {summary.trolley_motor.motor_type}")
    print(f"   å¤§è½¦è¿è¡Œç”µæœº: {summary.crane_motor.motor_type}")

    # æ£€æŸ¥ç»“æœ
    if summary.critical_issues:
        print("\nâš ï¸  å‘ç°é—®é¢˜:")
        for issue in summary.critical_issues:
            print(f"   - {issue}")
    else:
        print("\nâœ“ æ‰€æœ‰è®¡ç®—é¡¹ç›®å‡æ»¡è¶³è¦æ±‚!")

    print("\n" + "=" * 80)
    print("æ¼”ç¤ºç»“æŸã€‚æ‚¨å¯ä»¥ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤å¯åŠ¨å®Œæ•´ç³»ç»Ÿ:")
    print("  python main.py cli   # å‘½ä»¤è¡Œç•Œé¢")
    print("  python main.py web   # Webç•Œé¢")
    print("=" * 80)


if __name__ == "__main__":
    try:
        run_demo()
    except Exception as e:
        print(f"\nâŒ æ¼”ç¤ºè¿‡ç¨‹ä¸­å‘ç”Ÿé”™è¯¯: {e}")
        import traceback
        traceback.print_exc()
